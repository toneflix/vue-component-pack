"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("../config.js"),s=require("axios"),h=require("pinia"),g=require("vue");s.defaults.headers.common["Content-Type"]="application/json; charset=utf-8";s.defaults.headers.common.Accept="application/json";s.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function f(){return h.defineStore("vue-auth",()=>{const n=g.ref({}),c=g.ref(),l=g.ref(!1);return{user:n,token:c,isAuthenticated:l,login:async(t,r=u.getAuthConfig())=>{try{const{data:e}=await s.post(u.url("login"),t,r.axiosConfig),{user:o,token:a}=r.transformResponse?r.transformResponse(e):{user:e.user,token:e.token};return n.value=o,c.value=a,l.value=!0,localStorage.setItem(r.storageKey||"auth_token",e.token),{user:o,token:a}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{}}}},logout:async(t=u.getAuthConfig(),r)=>{const e=t.getAuthHeaders?await t.getAuthHeaders():{};try{await s.post(u.url("logout"),r,{headers:{...e},...t.axiosConfig}),n.value={},c.value=void 0,l.value=!1,localStorage.removeItem(t.storageKey||"auth_token")}catch({response:o}){return{error:(o==null?void 0:o.data)||{}}}},register:async(t,r=u.getAuthConfig())=>{try{const{data:e}=await s.post(u.url("register"),t,r.axiosConfig),{user:o,token:a}=r.transformResponse?r.transformResponse(e):{user:e.user,token:e.token};return n.value=o,c.value=a,l.value=!0,localStorage.setItem(r.storageKey||"auth_token",e.token),{user:o,token:a}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{}}}},loadUserFromStorage:async(t=u.getAuthConfig(),r)=>{const e=localStorage.getItem(t.storageKey||"auth_token"),o=t.getAuthHeaders?await t.getAuthHeaders():{};if(e&&(c.value=e,l.value=!0,t.endpoints.profile))try{const{data:a}=await s.get(u.url("profile"),{headers:{...o},params:{...r},...t.axiosConfig}),{user:i}=t.transformResponse?t.transformResponse(a):{user:a.user};return n.value=i,{user:i}}catch({response:a}){return{user:{},error:(a==null?void 0:a.data)||{}}}return{user:{}}}}})}const d=f();exports.createAuthStore=f;exports.useAuthStore=d;
