"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const g=require("vue"),u=require("../config.js"),c=require("axios"),y=require("pinia");c.defaults.headers.common["Content-Type"]="application/json; charset=utf-8";c.defaults.headers.common.Accept="application/json";c.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function h(){return y.defineStore("vue-auth",()=>{const d=g.ref({}),l=g.ref(),i=g.ref(!1);return{user:d,token:l,isAuthenticated:i,login:async(s,a=u.getAuthConfig())=>{var o;const n=u.url("login");try{const{data:e}=await c.post(n,g.toValue(s),a.axiosConfig),{user:t,token:r,message:m}=a.transformResponse?a.transformResponse(e):{user:e.user,token:e.token,message:e.message};return d.value=t,l.value=r,i.value=!0,localStorage.setItem(a.storageKey||"auth_token",e.token),{user:t,token:r,message:m}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},reset:async(s,a=u.getAuthConfig())=>{var o;const n=u.url("reset");try{const{data:e}=await c.post(n,g.toValue(s),a.axiosConfig),{user:t,message:r}=a.transformResponse?a.transformResponse(e):{user:e.user,message:e.message};return{user:t,message:r}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},logout:async(s=u.getAuthConfig(),a)=>{var e;const n=s.getAuthHeaders?await s.getAuthHeaders():{},o=u.url("logout");try{await c.post(o,g.toValue(a),{headers:{...n},...s.axiosConfig}),d.value={},l.value=void 0,i.value=!1,localStorage.removeItem(s.storageKey||"auth_token")}catch({response:t}){return{error:(t==null?void 0:t.data)||{},message:(e=t==null?void 0:t.data)==null?void 0:e.message}}},forgot:async(s,a=u.getAuthConfig())=>{var e;const n=a.getAuthHeaders?await a.getAuthHeaders():{},o=u.url("forgot");try{const{data:t}=await c.post(o,g.toValue(s),{headers:{...n},...a.axiosConfig}),{timeout:r,message:m}=a.transformResponse?a.transformResponse(t):{timeout:t.timeout,message:t.message},f=u.createCountdown(r);return{timeout:r,countdown:f,message:m}}catch({response:t}){return{error:(t==null?void 0:t.data)||{},countdown:g.ref(0),message:(e=t==null?void 0:t.data)==null?void 0:e.message}}},register:async(s,a=u.getAuthConfig())=>{var o;const n=u.url("register");try{const{data:e}=await c.post(n,g.toValue(s),a.axiosConfig),{user:t,token:r,message:m}=a.transformResponse?a.transformResponse(e):{user:e.user,token:e.token,message:e.message};return d.value=t,l.value=r,i.value=!0,localStorage.setItem(a.storageKey||"auth_token",e.token),{user:t,token:r,message:m}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},loadUserFromStorage:async(s=u.getAuthConfig(),a)=>{var e;const n=localStorage.getItem(s.storageKey||"auth_token"),o=s.getAuthHeaders?await s.getAuthHeaders():{};if(n&&(l.value=n,i.value=!0,s.endpoints.profile)){const t=u.url("profile");try{const{data:r}=await c.get(t,{headers:{...o},params:{...g.toValue(a)},...s.axiosConfig}),{user:m,message:f}=s.transformResponse?s.transformResponse(r):{user:r.user,message:r.message};return d.value=m,{user:m,message:f}}catch({response:r}){return{user:{},error:(r==null?void 0:r.data)||{},message:(e=r==null?void 0:r.data)==null?void 0:e.message}}}return{user:{}}}}})}const k=h();exports.createAuthStore=h;exports.useAuthStore=k;
