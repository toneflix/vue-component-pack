"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const g=require("vue"),n=require("../config.js"),c=require("axios"),y=require("pinia");c.defaults.headers.common["Content-Type"]="application/json; charset=utf-8";c.defaults.headers.common.Accept="application/json";c.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function h(){return y.defineStore("vue-auth",()=>{const d=g.ref({}),i=g.ref(),f=g.ref(!1);return{user:d,token:i,isAuthenticated:f,login:async(s,a=n.getAuthConfig())=>{var o;const u=n.url("login");try{const{data:e}=await c.post(u,g.toValue(s),a.axiosConfig),{user:t,token:r,message:l}=a.transformResponse?a.transformResponse(e):{user:e.user,token:e.token,message:e.message};return d.value=t,i.value=r,f.value=!0,localStorage.setItem(a.storageKey||"auth_token",e.token),{user:t,token:r,message:l}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},reset:async(s,a=n.getAuthConfig())=>{var o;const u=n.url("reset");try{const{data:e}=await c.post(u,g.toValue(s),a.axiosConfig),{user:t,message:r}=a.transformResponse?a.transformResponse(e):{user:e.user,message:e.message};return{user:t,message:r}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},logout:async(s=n.getAuthConfig(),a)=>{var e;const u=s.getAuthHeaders?await s.getAuthHeaders():{},o=n.url("logout");try{await c.post(o,g.toValue(a),{headers:{...u},...s.axiosConfig}),d.value={},i.value=void 0,f.value=!1,localStorage.removeItem(s.storageKey||"auth_token")}catch({response:t}){return{error:(t==null?void 0:t.data)||{},message:(e=t==null?void 0:t.data)==null?void 0:e.message}}},forgot:async(s,a=n.getAuthConfig())=>{var e;const u=a.getAuthHeaders?await a.getAuthHeaders():{},o=n.url("forgot");try{const{data:t}=await c.post(o,g.toValue(s),{headers:{...u},...a.axiosConfig}),{timeout:r,message:l}=a.transformResponse?a.transformResponse(t):{timeout:t.timeout,message:t.message},m=g.ref(0);if(r&&r>0){m.value=r;const v=setInterval(()=>{m.value-=1e3,m.value<=0&&clearInterval(v)},1e3)}return{timeout:r,countdown:m,message:l}}catch({response:t}){return{error:(t==null?void 0:t.data)||{},countdown:g.ref(0),message:(e=t==null?void 0:t.data)==null?void 0:e.message}}},register:async(s,a=n.getAuthConfig())=>{var o;const u=n.url("register");try{const{data:e}=await c.post(u,g.toValue(s),a.axiosConfig),{user:t,token:r,message:l}=a.transformResponse?a.transformResponse(e):{user:e.user,token:e.token,message:e.message};return d.value=t,i.value=r,f.value=!0,localStorage.setItem(a.storageKey||"auth_token",e.token),{user:t,token:r,message:l}}catch({response:e}){return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},loadUserFromStorage:async(s=n.getAuthConfig(),a)=>{var e;const u=localStorage.getItem(s.storageKey||"auth_token"),o=s.getAuthHeaders?await s.getAuthHeaders():{};if(u&&(i.value=u,f.value=!0,s.endpoints.profile)){const t=n.url("profile");try{const{data:r}=await c.get(t,{headers:{...o},params:{...g.toValue(a)},...s.axiosConfig}),{user:l,message:m}=s.transformResponse?s.transformResponse(r):{user:r.user,message:r.message};return d.value=l,{user:l,message:m}}catch({response:r}){return{user:{},error:(r==null?void 0:r.data)||{},message:(e=r==null?void 0:r.data)==null?void 0:e.message}}}return{user:{}}}}})}const k=h();exports.createAuthStore=h;exports.useAuthStore=k;
