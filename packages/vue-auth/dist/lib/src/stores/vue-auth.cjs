"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const d=require("vue"),g=require("../utils/config.cjs"),m=require("axios"),k=require("pinia"),A=require("../utils/plugins.cjs");m.defaults.headers.common["Content-Type"]="application/json; charset=utf-8";m.defaults.headers.common.Accept="application/json";m.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function v(i){return k.defineStore("vue-auth",()=>{const n=d.ref({}),l=d.ref(),h=d.ref(!1);return{user:n,token:l,isAuthenticated:h,login:async(s,r=g.getAuthConfig())=>{var o;const c=g.url("login");try{const{data:t}=await m.post(c,d.toValue(s),r.axiosConfig),{user:e,token:a,message:u}=r.transformResponse?r.transformResponse(t):{user:t.user,token:t.token,message:t.message};return n.value=e,l.value=a,h.value=!0,localStorage.setItem(r.storageKey||"auth_token",t.token),{user:e,token:a,message:u}}catch(t){const{response:e}=t;return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},reset:async(s,r=g.getAuthConfig())=>{var o;const c=g.url("reset");try{const{data:t}=await m.post(c,d.toValue(s),r.axiosConfig),{user:e,message:a}=r.transformResponse?r.transformResponse(t):{user:t.user,message:t.message};return{user:e,message:a}}catch(t){const{response:e}=t;return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},logout:async(s=g.getAuthConfig(),r)=>{var t;const c=s.setAuthHeaders?await s.setAuthHeaders({user:n.value,token:l.value}):s.getAuthHeaders?await s.getAuthHeaders({user:n.value,token:l.value}):{},o=g.url("logout");try{await m.post(o,d.toValue(r),{headers:{...c},...s.axiosConfig}),n.value={},l.value=void 0,h.value=!1,localStorage.removeItem(s.storageKey||"auth_token")}catch(e){const{response:a}=e;return{error:(a==null?void 0:a.data)||{},message:(t=a==null?void 0:a.data)==null?void 0:t.message}}},forgot:async(s,r=g.getAuthConfig())=>{var t;const c=r.setAuthHeaders?await r.setAuthHeaders({user:n.value,token:l.value}):r.getAuthHeaders?await r.getAuthHeaders({user:n.value,token:l.value}):{},o=g.url("forgot");try{const{data:e}=await m.post(o,d.toValue(s),{headers:{...c},...r.axiosConfig}),{timeout:a,message:u}=r.transformResponse?r.transformResponse(e):{timeout:e.timeout,message:e.message},f=A.createCountdown(a);return{timeout:a,countdown:f,message:u}}catch(e){const{response:a}=e;return{error:(a==null?void 0:a.data)||{},countdown:d.ref(0),message:(t=a==null?void 0:a.data)==null?void 0:t.message}}},register:async(s,r=g.getAuthConfig())=>{var o;const c=g.url("register");try{const{data:t}=await m.post(c,d.toValue(s),r.axiosConfig),{user:e,token:a,message:u}=r.transformResponse?r.transformResponse(t):{user:t.user,token:t.token,message:t.message};return n.value=e,l.value=a,h.value=!0,localStorage.setItem(r.storageKey||"auth_token",t.token),{user:e,token:a,message:u}}catch(t){const{response:e}=t;return{user:{},error:(e==null?void 0:e.data)||{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},loadUserFromStorage:async(s=g.getAuthConfig(),r)=>{var t;const c=localStorage.getItem(s.storageKey||"auth_token"),o=s.setAuthHeaders?await s.setAuthHeaders({user:n.value,token:l.value}):s.getAuthHeaders?await s.getAuthHeaders({user:n.value,token:l.value}):{};if(c&&(l.value=c,h.value=!0,s.endpoints.profile)){const e=g.url("profile");try{const{data:a}=await m.get(e,{headers:{...o},params:{...d.toValue(r)},...s.axiosConfig}),{user:u,message:f}=s.transformResponse?s.transformResponse(a):{user:a.user,message:a.message};return n.value=u,{user:u,message:f}}catch(a){const{response:u}=a;return{user:{},error:(u==null?void 0:u.data)||{},message:(t=u==null?void 0:u.data)==null?void 0:t.message}}}return{user:{}}}}},i)}const y=i=>v(i)();exports.createVueAuthStore=v;exports.useAuthStore=y;
