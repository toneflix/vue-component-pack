"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("vue"),u=require("../utils/config.cjs"),d=require("axios"),S=require("pinia"),C=require("../utils/plugins.cjs");d.defaults.headers.common["Content-Type"]="application/json; charset=utf-8";d.defaults.headers.common.Accept="application/json";d.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function k(h){return S.defineStore("vue-auth",()=>{const n=i.ref({}),m=i.ref(),y=i.ref(!1),f=i.ref(!1);return{user:n,token:m,refreshed:y,isAuthenticated:f,login:async(s,r=u.getAuthConfig())=>{var o;const l=u.url("login");try{const{data:t}=await d.post(l,i.toValue(s),r.axiosConfig),{user:e,token:a,message:c}=r.transformResponse?r.transformResponse(t):{user:t.user,token:t.token,message:t.message};return n.value=e,m.value=a,f.value=!0,globalThis.localStorage.setItem(r.storageKey??"auth_token",t.token),{user:e,token:a,message:c}}catch(t){const{response:e}=t;return{user:{},error:(e==null?void 0:e.data)??t??{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},reset:async(s,r=u.getAuthConfig())=>{var o;const l=u.url("reset");try{const{data:t}=await d.post(l,i.toValue(s),r.axiosConfig),{user:e,message:a}=r.transformResponse?r.transformResponse(t):{user:t.user,message:t.message};return{user:e,message:a}}catch(t){const{response:e}=t;return{user:{},error:(e==null?void 0:e.data)??t??{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},logout:async(s=u.getAuthConfig(),r)=>{var t;const l=await u.buildHeaders(s,n.value,m.value),o=u.url("logout");try{await d.post(o,i.toValue(r),{headers:{...l},...s.axiosConfig}),n.value={},m.value=void 0,f.value=!1,globalThis.localStorage.removeItem(s.storageKey??"auth_token")}catch(e){const{response:a}=e;return{error:(a==null?void 0:a.data)??e??{},message:(t=a==null?void 0:a.data)==null?void 0:t.message}}},forgot:async(s,r=u.getAuthConfig())=>{var t;const l=await u.buildHeaders(r,n.value,m.value),o=u.url("forgot");try{const{data:e}=await d.post(o,i.toValue(s),{headers:{...l},...r.axiosConfig}),{timeout:a,message:c}=r.transformResponse?r.transformResponse(e):{timeout:e.timeout,message:e.message},g=C.createCountdown(a);return{timeout:a,countdown:g,message:c}}catch(e){const{response:a}=e;return{error:(a==null?void 0:a.data)??e??{},countdown:i.ref(0),message:(t=a==null?void 0:a.data)==null?void 0:t.message}}},register:async(s,r=u.getAuthConfig())=>{var o;const l=u.url("register");try{const{data:t}=await d.post(l,i.toValue(s),r.axiosConfig),{user:e,token:a,message:c}=r.transformResponse?r.transformResponse(t):{user:t.user,token:t.token,message:t.message};return n.value=e,m.value=a,f.value=!0,globalThis.localStorage.setItem(r.storageKey??"auth_token",t.token),{user:e,token:a,message:c}}catch(t){const{response:e}=t;return{user:{},error:(e==null?void 0:e.data)??t??{},message:(o=e==null?void 0:e.data)==null?void 0:o.message}}},loadUserFromStorage:async(s=u.getAuthConfig(),r,l)=>{var e;const o=globalThis.localStorage.getItem(s.storageKey??"auth_token")??m.value,t=await u.buildHeaders(s,n.value,m.value);if(o&&s.endpoints.profile&&(m.value=o,f.value=!0,!l||!s.disableAutoRefresh)){const a=u.url("profile");try{const{data:c}=await d.get(a,{headers:{...t},params:{...i.toValue(r)},...s.axiosConfig}),{user:g,message:v}=s.transformResponse?s.transformResponse(c):{user:c.user,message:c.message};return n.value=g,{user:g,message:v}}catch(c){const{response:g,status:v}=c;return v===401&&(n.value={},m.value=void 0,y.value=!0,f.value=!1,globalThis.localStorage.removeItem(s.storageKey??"auth_token")),{user:{},error:(g==null?void 0:g.data)??c??{},message:(e=g==null?void 0:g.data)==null?void 0:e.message}}}return Object.entries(n.value).length>0?{user:n.value}:{user:{}}}}},h)}const A=h=>k(h)();exports.createVueAuthStore=k;exports.useAuthStore=A;
